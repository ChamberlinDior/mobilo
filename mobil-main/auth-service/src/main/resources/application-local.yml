######################################################################
#  PROFIL  « local »
#  (spécifique au poste de dev / CI – surcharge minimale)
######################################################################

spring:
  config:
    activate:
      on-profile: local                     # ← active ce fichier quand le profil = local
    import: "classpath:application.yml"     # ⇦ hérite de la config par défaut

  # ───────────────────────────────────────────────────────────────
  # CACHE (Caffeine) – valeurs plus agressives pour le dev
  # ───────────────────────────────────────────────────────────────
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=2_000,expireAfterWrite=30s

  # ───────────────────────────────────────────────────────────────
  # DATASOURCE (MySQL local)
  # ───────────────────────────────────────────────────────────────
  datasource:
    url: jdbc:mysql://localhost:3306/mobilite?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10

  # ───────────────────────────────────────────────────────────────
  # JPA / HIBERNATE
  # ───────────────────────────────────────────────────────────────
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
    show-sql: false

  # ───────────────────────────────────────────────────────────────
  # SECURITY – JWT resource server
  # ───────────────────────────────────────────────────────────────
  security:
    oauth2:
      resourceserver:
        jwt:
          secret: ${app.jwt.secret}

  # ───────────────────────────────────────────────────────────────
  # MULTIPART UPLOAD (no limit en dev)
  # ───────────────────────────────────────────────────────────────
  servlet:
    multipart:
      max-file-size: -1
      max-request-size: -1

  # ───────────────────────────────────────────────────────────────
  # TASK SCHEDULING
  # ───────────────────────────────────────────────────────────────
  task:
    scheduling:
      pool:
        size: 4

  # ───────────────────────────────────────────────────────────────
  # MAIL (stub local)
  # ───────────────────────────────────────────────────────────────
  mail:
    host: localhost
    port: 2500
    username: ""
    password: ""
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: false
          starttls:
            enable: false
    from: no-reply@ride-service.example.com

# ───────────────────────────────────────────────────────────────
# LOGS – visibilité des push en dev
# ───────────────────────────────────────────────────────────────
logging:
  level:
    root: INFO
    com.mobility: DEBUG
    com.mobility.ride.service.push: DEBUG
    org.springframework.web: INFO
    org.hibernate.SQL: WARN
    org.hibernate.orm.jdbc.bind: WARN

# ───────────────────────────────────────────────────────────────
# SERVER & ACTUATOR (utile en dev)
# ───────────────────────────────────────────────────────────────
server:
  forward-headers-strategy: framework
  compression:
    enabled: true

management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics"
  endpoint:
    health:
      show-details: when_authorized

# ───────────────────────────────────────────────────────────────
#  SECTION  « app »  – secrets/email/API-keys propres au dev
# ───────────────────────────────────────────────────────────────
app:
  jwt:
    secret: sCyaX+2NsXpvQUvJBA0Xzj6EObLLZEfggYg0RUe2D68=
    issuer: mobility-auth
    clock-skew-sec: 60

  # CORS dev (si ton SecurityConfig les lit)
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://localhost:5173
      - http://localhost:19006           # Expo Web
      - exp://127.0.0.1:19000            # Expo Go
    allowed-methods: [GET,POST,PUT,DELETE,OPTIONS]
    allowed-headers: ["*"]

  payments:
    provider: stub                        # ← aucun débit réel en local
    accepted-providers: [STRIPE, APPLE_PAY, PAYPAL, CASH, AIRTEL_MONEY_GA]
    stripe:
      secret-key: ""                      # clés vides en local
      webhook-secret: ""
    paypal:
      client-id: ""
      client-secret: ""
      webhook-id: ""
    apple:
      merchant-id: ""
      merchant-cert: ""
      merchant-key: ""
    airtel-ga:
      api-key: ""
      api-secret: ""
      base-url: https://openapi.airtel.africa
      webhook-secret: ""

  # Forcer Expo en local pour Expo Go
  push:
    provider: expo
    expo:
      api: https://exp.host/--/api/v2/push/send
      maxBatch: 90
    fcm:
      serverKey: ""                      # non utilisé en local (Expo Go)
      endpoint: https://fcm.googleapis.com/fcm/send

  geocoding:
    api-key: AIzaSyBViGGakHSvDKELeL_3xX3bcfpVddpFIUg   # clé Google Geocoding (dev)

# ───────────────────────────────────────────────────────────────
#  DEVISE PAR GÉOLOCALISATION (US/EUR/XAF)
# ───────────────────────────────────────────────────────────────
currency:
  geo:
    enabled: true
    fallback: USD
    countryCurrencyMap:
      US: USD
      FR: EUR
      GA: XAF

# ───────────────────────────────────────────────────────────────
#  EXCHANGE-RATES (optionnel en local – peut rester vide)
# ───────────────────────────────────────────────────────────────
exchange:
  api:
    url: https://api.exchangerate.host/latest
    key: ""                               # vide = accès libre ou mock
  cacheTtlSeconds: 300

# ───────────────────────────────────────────────────────────────
#  WALLET – règles pro en local (arrondis, limites, idempotency)
# ───────────────────────────────────────────────────────────────
wallet:
  currency:
    default: USD
    rounding:
      USD: 2
      EUR: 2
      XAF: 0
  kyc:
    withdrawMinLevel: VERIFIED            # exiger KYC vérifié pour retrait
  idempotency:
    enabled: true
    ttlSeconds: 86400                     # 24h si cache mémoire côté app
  limits:
    XAF:
      topup:
        min: 500
        max_daily: 200000
      withdraw:
        min: 1000
        max_daily: 100000
    USD:
      topup:
        min: 2
        max_daily: 1000
      withdraw:
        min: 5
        max_daily: 500
    EUR:
      topup:
        min: 2
        max_daily: 1000
      withdraw:
        min: 5
        max_daily: 500
  payouts:
    routing:
      USD: ACH
      EUR: SEPA
      XAF: MOBILE_MONEY

######################################################################
#  👉  Aucun bloc `pricing:` ici : la grille France / USA / Gabon
#      reste celle définie dans  application.yml
######################################################################
